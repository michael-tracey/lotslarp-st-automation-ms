<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  </head>
  <body>
    <div class="container">
      <p>Enter the password to encrypt for the selected narrator row.</p>
      <div class="block">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" class="width-100">
      </div>
      <div class="block">
        <button class="action" id="encrypt-btn">Encrypt and Save</button>
        <button onclick="google.script.host.close()">Cancel</button>
      </div>
      <p id="status"></p>
    </div>

    <script>
      document.getElementById('encrypt-btn').addEventListener('click', function() {
        var password = document.getElementById('password').value;
        if (!password) {
          document.getElementById('status').innerText = 'Please enter a password.';
          return;
        }

        document.getElementById('status').innerText = 'Encrypting...';
        google.script.run
          .withSuccessHandler(function(message) {
            document.getElementById('status').innerText = message;
            if (message.toLowerCase().includes('successfully')) {
              setTimeout(function() {
                google.script.host.close();
              }, 4000); // Longer delay to read the warning
            }
          })
          .withFailureHandler(function(err) {
            document.getElementById('status').innerText = 'Error: ' + err.message;
          })
          .encryptPassword(password);
      });
    </script>
  </body>
</html>